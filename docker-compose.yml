version: "3.8"

services:
  his-api:
    image: ghcr.io/amerhashima/his-api:latest
    container_name: his-api
    ports:
      - "5000:8080"
      - "5001:8081"
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ASPNETCORE_URLS: http://+:8080;https://+:8081
      ASPNETCORE_HTTPS_PORTS: 8081
      ConnectionStrings__DefaultConnection: >
        Server=his-db;
        Database=HISDatabase;
        User Id=sa;
        Password=${DB_SA_PASSWORD};
        TrustServerCertificate=true;
      JwtSettings__Issuer: ${JWT_ISSUER}
      JwtSettings__Audience: ${JWT_AUDIENCE}
      JwtSettings__SecretKey: ${JWT_SECRET_KEY}
    depends_on:
      - his-db
    networks:
      - his-network
    restart: unless-stopped

  his-db:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: his-db
    environment:
      ACCEPT_EULA: "Y"
      SA_PASSWORD: ${DB_SA_PASSWORD}
      MSSQL_PID: Express
    ports:
      - "1433:1433"
    volumes:
      - his-db-data:/var/opt/mssql
    networks:
      - his-network
    restart: unless-stopped

volumes:
  his-db-data:

networks:
  his-network:
    driver: bridge
